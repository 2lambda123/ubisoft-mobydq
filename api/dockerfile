FROM alpine
MAINTAINER Erignoux Laurent <lerignoux@gmail.com>

# basic flask environment
RUN apk add --no-cache curl gcc g++ bash git nginx uwsgi uwsgi-python3 python3-dev unixodbc-dev libffi-dev openssl-dev\
	&& pip3 install --upgrade pip \
	&& pip3 install flask

RUN ln -s /usr/include/locale.h /usr/include/xlocale.h

# application folder
ENV APP_DIR /app

# app dir
RUN mkdir ${APP_DIR} \
	&& chown -R nginx:nginx ${APP_DIR} \
	&& chmod 777 /run/ -R \
	&& chmod 777 /root/ -R
VOLUME [${APP_DIR}]
WORKDIR ${APP_DIR}

# expose web server port
# only http, for ssl use reverse proxy
EXPOSE 5000

# copy config files into filesystem
COPY docker_nginx.ini /etc/nginx/nginx.conf
COPY docker_container.ini /app.ini
COPY docker_container.sh /entrypoint.sh

# exectute start up script
ENTRYPOINT ["/entrypoint.sh"]
